<!-- Here we check that robot goes forward to the wall, touches it and then back for 3 times -->
<constraints>
	<timelimit value="30000"/>

	<constraint failMessage="На порту A1 должен быть выставлен сенсор касания, стерва!" checkOnce="true">
		<equals>
			<typeof objectId="sensorA1"/>
			<string value="TouchSensor"/>
		</equals>
	</constraint>

	<constraint failMessage="На порту M1 должен быть мотор!" checkOnce="true">
		<equals>
			<typeof objectId="motorM1"/>
			<string value="PowerMotor"/>
		</equals>
	</constraint>

	<constraint failMessage="На порту M2 должен быть мотор!" checkOnce="true">
		<equals>
			<typeof objectId="motorM2"/>
			<string value="PowerMotor"/>
		</equals>
	</constraint>

	<constraint failMessage="Робот покинул допустимую зону!">
		<inside objectId="robot" regionId="warzone"/>
	</constraint>

	<event id="We are alive, first move" setUpInitially="true" [dropsOnFire="true/false"]>
		<conditions [glue="and/or"]> <!-- optional -->
			<condition>
				<greater>
					<objectState objectId="motorM1" property="power"/>
					<int value="0"/>
				</greater>
			</condition>
		</conditions>
		<triggers> <!-- optional -->
			<trigger>
				<setUp id="Touching wall"/>
			</trigger>
			<trigger>
				<setVariable name="counter" value="0"/>
			</trigger>
		</triggers>
	</event>

	<event id="Waiting for going forward too long" setUpInitially="true">
		<conditions>
			<condition>
				<timer timeout="1000" forceDropOnTimeout="true"/>
				<settedUp id="We are alive, first move"/>
			</condition>
		</conditions>
		<trigger>
			<fail message="Робот так и не поехал в первую секунду"/>
		</trigger>
	</event>

	<event id="Touching wall">
		<condition>
			<equals>
				<objectState objectId="sensorA1" property="value"/>
				<int value="1"/>
			</equals>
		</condition>
		<trigger>
			<setUp id="Returned back"/>
		</trigger>
	</event>

	<event id="Returned back">
		<condition>
			<inside objectId="robot" regionId="start_zone"/>
		</condition>
		<triggers>
			<trigger>
				<setUp id="Touching wall"/>
			</trigger>
			<trigger>
				<addToVariable name="counter" value="1"/>
			</trigger>
			<trigger>
				<setUp id="Done?"/>
			</trigger>
		</triggers>
	</event>

	<event id="Done?">
		<conditions>
			<timer timeout="0" forceDropOnTimeout="true"/>
			<greaterOrEquals>
				<variableValue name="counter"/>
				<int value="3"/>
			</equals>
		</conditions>
		<trigger>
			<success/>
		</trigger>
	</event>

	<!-- Подумать над случаем, когда программа завершается раньше времени - должна ли быть встроенная обработка? -->
</constraints>
